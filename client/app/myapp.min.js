"use strict";!function(){function t(){var t=angular.injector(["ng"]),e=t.get("$http");return e.get("/api/config").then(function(t){r.constant("myConfig",t.data)})}function e(){angular.element(document).ready(function(){angular.bootstrap(document,["myApp"])})}var r=angular.module("myApp",["ngRoute","ngMaterial","uiGmapgoogle-maps"]);r.config(["myConfig","$routeProvider","uiGmapGoogleMapApiProvider",function(t,e,r){e.when("/Home",{templateUrl:"/app/views/home.html",controller:"homeCtrl",controllerAs:"vm"}).when("/Config",{templateUrl:"/app/views/config.html",controller:"configCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/Home"}),r.configure({key:t.googleKey,v:"3.23",libraries:"places"})}]),t().then(e)}(),function(){var t=angular.module("myApp");t.directive("d3Line",[function(){function t(t,e){t.$watch("data",function(t){if(t&&0!=t.length){var r=400,a=200,n={top:10,right:10,bottom:20,left:30};r=r-n.left-n.right,a=a-n.top-n.bottom;var o=d3.extent(t,function(t,e){return new Date(t.time)}),i=d3.extent(t,function(t,e){return t.temp}),c=d3.time.scale().domain(o).range([0,r]),l=d3.scale.linear().domain(i).range([a,0]),m=d3.svg.axis().scale(c).orient("bottom").tickFormat(function(t){return moment(t).format("HH[h]")}),u=d3.svg.axis().scale(l).orient("left"),s=d3.svg.line().x(function(t){return c(new Date(t.time))}).y(function(t){return l(t.temp)});d3.select(e[0]).selectAll("*").remove();var d=d3.select(e[0]).append("div").attr("class","d3-chart-container"),f=d.append("svg").attr("width",r+n.left+n.right).attr("height",a+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")");f.append("g").attr("class","x axis").attr("transform","translate(0,"+a+")").call(m),f.append("g").attr("class","y axis").call(u),f.append("path").datum(t).attr("class","line").attr("d",s)}})}return{restrict:"E",scope:{data:"="},link:t}}]),t.directive("d3Gauge",[function(){function t(t,e){var r={len:75,rad:12},a=function(){var t=m(e/2),a=-r.len*Math.cos(t),n=-r.len*Math.sin(t),o=-r.rad*Math.cos(t-Math.PI/2),i=-r.rad*Math.sin(t-Math.PI/2),c=-r.rad*Math.cos(t+Math.PI/2),l=-r.rad*Math.sin(t+Math.PI/2);return"M "+o+" "+i+" L "+a+" "+n+" L "+c+" "+l};t.append("circle").attr("class","needle-center").attr("cx",0).attr("cy",0).attr("r",r.rad),t.append("path").attr("class","needle").attr("d",a())}function e(e,c){e.$watch("data",function(e){if(e){var l=200,u=200,s={top:10,right:10,bottom:10,left:10};l=l-s.left-s.right,u=u-s.top-s.bottom;var d=Math.min(l,u)/2;d3.select(c[0]).selectAll("*").remove();for(var f=d3.select(c[0]).append("div").attr("class","d3-chart-container"),p=f.append("svg").attr("width",l+s.left+s.right).attr("height",u/2+s.top+s.bottom).append("g").attr("transform","translate("+(d+s.left/2)+", "+d+")"),v=.75,h=1;r>=h;h++){var g=m(v),w=g+m(a);v+=a;var y=1==h?0:n/2,$=h==r?0:n/2,C=d3.svg.arc().outerRadius(d-i).innerRadius(d-i-o).startAngle(g+y).endAngle(w-$);p.append("path").attr("class","arc chart-color"+h).attr("d",C)}t(p,e/150)}})}var r=3,a=1/r/2,n=.05,o=40,i=10,c=function(t){return 360*t},l=function(t){return t*Math.PI/180},m=function(t){return l(c(t))};return{restrict:"E",scope:{data:"="},link:e}}])}(),function(){var t=angular.module("myApp");t.controller("homeCtrl",["$window","$scope","$interval","myConfig",function(t,e,r,a){function n(){o.isWorkingDay=moment().startOf("day").isWorkingDay()}var o=this;o.isWorkingDay=!0,"development"==a.env&&(o.debug=$(window).width()+"x"+$(window).height(),$(t).resize(function(){e.$apply(function(){o.debug=$(window).width()+"x"+$(window).height()})}));var i=r(n,108e5);e.$on("$destroy",function(){angular.isDefined(i)&&(r.cancel(i),i=void 0)}),n()}])}(),function(){function t(t){return function(e){var r=e.getPlaces();if(0!=r.length){var a=r[0];t.longitude=a.geometry.location.lng(),t.latitude=a.geometry.location.lat()}}}var e=angular.module("myApp");e.controller("configCtrl",["$http","$scope","myConfig",function(r,a,n){var o=this;o.weather={location:n.weather.location,zoom:15,searchbox:{template:"searchbox.tpl.html",events:{}}},o.weather.searchbox.events.places_changed=t(o.weather.location),o.travel={from:{location:n.travelTime.from,zoom:15,searchbox:{template:"searchbox.tpl.html",events:{}}},to:{location:n.travelTime.to,zoom:15,searchbox:{template:"searchbox.tpl.html",events:{}}}},o.travel.from.searchbox.events.places_changed=t(o.travel.from.location),o.travel.to.searchbox.events.places_changed=t(o.travel.to.location),o.mic=n.mic,o.rer={depart:"",arrivee:""},o.gares=[],r.get("/api/rer/gares").then(function(t){o.gares=t.data.map(function(t){return t.search=t.nom.toLowerCase().replace(/\W/g,""),t}),n.rer.depart&&(o.rer.depart=o.gares.find(function(t){return t.uic==n.rer.depart}),o.rer.arrivee=o.gares.find(function(t){return t.uic==n.rer.arrivee}))}),o.searchGare=function(t){var e=(t||"").toLowerCase().replace(/\W/g,"");return o.gares.filter(function(t){return t.search.indexOf(e)>=0})},o.save=function(){n.weather.location=o.weather.location,n.travelTime.from=o.travel.from.location,n.travelTime.to=o.travel.to.location,n.mic.username=o.mic.username,n.rer.depart=o.rer.depart.uic,n.rer.arrivee=o.rer.arrivee.uic,r.post("/api/config",n).then(function(t){e.constant("myConfig",n)})}}])}(),function(){function t(t){return"wi-forecast-io-"+t}var e=angular.module("myApp");e.controller("weatherCtrl",["$scope","$http","$interval","myConfig",function(e,r,a,n){function o(){var e=n.weather.location.latitude+","+n.weather.location.longitude;r.get("/api/weather/"+e).then(function(e){i.weather=e.data,i.weather.currently["class"]=t(i.weather.currently.icon),i.tempchart=i.weather.day.data})}var i=this;i.weather={},i.tempchart=[];var c=a(o,6e5);e.$on("$destroy",function(){angular.isDefined(c)&&(a.cancel(c),c=void 0)}),o()}]),e.directive("weather",function(){return{restrict:"E",scope:{},templateUrl:"/app/views/weather.html",controller:"weatherCtrl",controllerAs:"vm"}})}(),function(){var t=angular.module("myApp");t.directive("dateTime",["$interval",function(t){function e(e,r){e.time=moment().format("LT"),e.day=moment().format("dddd"),e.date=moment().format("LL");var a=t(function(){e.time=moment().format("LT"),e.day=moment().format("dddd"),e.date=moment().format("LL")},2e3);r.on("$destroy",function(){angular.isDefined(a)&&(t.cancel(a),a=void 0)})}return{restrict:"E",templateUrl:"/app/views/date-time.html",link:e}}])}(),function(){var t=angular.module("myApp");t.controller("micCtrl",["$scope","$http","$interval","myConfig",function(t,e,r,a){function n(){var t=a.mic.username;t&&e.get("/api/mic/"+t).then(function(t){o.quarter=t.data.quarter,o.PG1=t.data.PG1,o.PG2=t.data.PG2})}var o=this,i=r(n,18e6);t.$on("$destroy",function(){angular.isDefined(i)&&(r.cancel(i),i=void 0)}),n()}]),t.directive("mic",function(){return{restrict:"E",scope:{},templateUrl:"/app/views/mic.html",controller:"micCtrl",controllerAs:"vm"}})}(),function(){var t=angular.module("myApp");t.controller("travelCtrl",["$scope","$http","$interval","myConfig",function(t,e,r,a){function n(){var t="?from="+i+"&to="+c;e.get("/api/travel"+t).then(function(t){o.routes=t.data,o.routes.map(function(t){t.nicedist=(t.dist/1e3).toFixed(2)+"km";var e=moment.duration(t.time,"s");return t.nicetime="",e.hours()>0&&(t.nicetime=e.hours()+"h "),t.nicetime+=e.minutes()+" min",t})})}var o=this;o.routes=[];var i=a.travelTime.from.latitude+","+a.travelTime.from.longitude,c=a.travelTime.to.latitude+","+a.travelTime.to.longitude,l=r(n,36e4);t.$on("$destroy",function(){angular.isDefined(l)&&(r.cancel(l),l=void 0)}),n()}]),t.directive("travel",function(){return{restrict:"E",scope:{},templateUrl:"/app/views/travel-time.html",controller:"travelCtrl",controllerAs:"vm"}})}(),function(){var t=angular.module("myApp");t.controller("rerCtrl",["$scope","$http","$interval","myConfig",function(t,e,r,a){function n(){if(a.rer.depart&&a.rer.arrivee){var t="/api/rer/trains/"+a.rer.depart+"/"+a.rer.arrivee;e.get(t).then(function(t){o.trains=t.data.map(function(t){return t.date=moment(t.date),t.nicedate=t.date.fromNow(),t.exact=t.date.format("LT"),t})})}}var o=this;o.trains=[];var i=r(n,6e4);t.$on("$destroy",function(){angular.isDefined(i)&&(r.cancel(i),i=void 0)}),n()}]),t.directive("rer",function(){return{restrict:"E",scope:{},templateUrl:"/app/views/rer.html",controller:"rerCtrl",controllerAs:"vm"}})}();